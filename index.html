<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Vector Data</title>
    <meta charset="utf-8" />
    <meta name="author" content="Víctor Granda" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="resources/css/custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: title-slide




# Vector data

## Víctor Granda

### Ecosystem Modelling Facility

### 14/03/2022

&lt;img class="logo-title" src="resources/img/emf_logo.svg" width=300&gt;

---

class: code70
layout: true

&lt;div class=my-header&gt;
    &lt;img class="emf-logo" src="resources/img/emf_logo.svg"&gt;
&lt;/div&gt;

# Simple features (sf)

&lt;div class=my-footer&gt;&lt;/div&gt;

---

.center[
&lt;img src="resources/img/sf_allison_horst.jpg" width="400" style="display: block; margin: auto;" /&gt;
]

.right[
.font80[(Illustration (c) by Allison Horst)]
]

Simple features are included in the [ISO 19125-1:2004](https://www.iso.org/standard/40114.html)
standard. This standard decribes how real world objects are represented in computers, with
special emphasis in spatial geometry.

---

## Dimensions

Geometries are composed of points, coordinates in XY space (north-east, lat-long...):

  - **XY**
  - **XYZ** (Z = altitude)
  - **XYM** (M = coordinate referring to the point, could be time or coordinates measuring error)
  - **XYZM** (both, Z and M)

And also can have attributes related to each geometry (think about things as
biomass, temperature...)

---

## Geometry types

  - **POINT**: zero-dimensional geometry containing a single point
  - **LINESTRING**: sequence of points connected by straight, non-self intersecting
  line pieces; one-dimensional geometry
  - **POLYGON**: geometry with a positive area (two-dimensional); sequence of points
  form a closed, non-self intersecting ring; the first ring denotes the exterior
  ring, zero or more subsequent rings denote holes in this exterior ring
  - **MULTIPOINT**: set of points; a MULTIPOINT is simple if no two Points in the
  MULTIPOINT are equal
  - **MULTILINESTRING**: set of linestrings
  - **MULTIPOLYGON**: set of polygons
  - **GEOMETRYCOLLECTION**: set of geometries of any type except GEOMETRYCOLLECTION

---

## Simple features in R

1. "Ol'good" `sp` package. The standard in R for many years

2. "New kid on the block" `sf` package. The "new" R standard for spatial simple
features.

---

## `sf` package


```r
install.packages("sf")
```

---

## `sf` package


```r
library(sf)

nc &lt;- st_read(system.file("shape/nc.shp", package="sf"))
```

```
## Reading layer `nc' from data source 
##   `/home/malditobarbudo/R/x86_64-pc-linux-gnu-library/4.1/sf/shape/nc.shp' using driver `ESRI Shapefile'
## Simple feature collection with 100 features and 14 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965
## Geodetic CRS:  NAD27
```

---

## `sf` package


```r
nc
```

```
## Simple feature collection with 100 features and 14 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965
## Geodetic CRS:  NAD27
## First 10 features:
##     AREA PERIMETER CNTY_ CNTY_ID        NAME  FIPS FIPSNO CRESS_ID BIR74 SID74 NWBIR74 BIR79 SID79
## 1  0.114     1.442  1825    1825        Ashe 37009  37009        5  1091     1      10  1364     0
## 2  0.061     1.231  1827    1827   Alleghany 37005  37005        3   487     0      10   542     3
## 3  0.143     1.630  1828    1828       Surry 37171  37171       86  3188     5     208  3616     6
## 4  0.070     2.968  1831    1831   Currituck 37053  37053       27   508     1     123   830     2
## 5  0.153     2.206  1832    1832 Northampton 37131  37131       66  1421     9    1066  1606     3
## 6  0.097     1.670  1833    1833    Hertford 37091  37091       46  1452     7     954  1838     5
## 7  0.062     1.547  1834    1834      Camden 37029  37029       15   286     0     115   350     2
## 8  0.091     1.284  1835    1835       Gates 37073  37073       37   420     0     254   594     2
## 9  0.118     1.421  1836    1836      Warren 37185  37185       93   968     4     748  1190     2
## 10 0.124     1.428  1837    1837      Stokes 37169  37169       85  1612     1     160  2038     5
##    NWBIR79                       geometry
## 1       19 MULTIPOLYGON (((-81.47276 3...
## 2       12 MULTIPOLYGON (((-81.23989 3...
## 3      260 MULTIPOLYGON (((-80.45634 3...
## 4      145 MULTIPOLYGON (((-76.00897 3...
## 5     1197 MULTIPOLYGON (((-77.21767 3...
## 6     1237 MULTIPOLYGON (((-76.74506 3...
## 7      139 MULTIPOLYGON (((-76.00897 3...
## 8      371 MULTIPOLYGON (((-76.56251 3...
## 9      844 MULTIPOLYGON (((-78.30876 3...
## 10     176 MULTIPOLYGON (((-80.02567 3...
```

---

## `sf` package


```r
class(nc)
```

```
## [1] "sf"         "data.frame"
```

```r
attr(nc, "sf_column")
```

```
## [1] "geometry"
```

```r
class(nc$geometry)
```

```
## [1] "sfc_MULTIPOLYGON" "sfc"
```

```r
class(nc$geometry[[1]])
```

```
## [1] "XY"           "MULTIPOLYGON" "sfg"
```

---

## read data


```r
lidar_data &lt;- st_read('lidar_data.gpkg', quiet = TRUE)

lidar_data
```

```
## Simple feature collection with 42 features and 9 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 0.1626252 ymin: 40.52296 xmax: 3.321198 ymax: 42.86144
## Geodetic CRS:  WGS 84
## First 10 features:
##           poly_id  poly_km2 AB_pixels AB_average     AB_sd AB_min AB_max    AB_km2 AB_km2_perc
## 1        Alt Camp  537.6352    482120   16.69471  8.207308   0.01    100  192.8480    35.86968
## 2     Alt Empordà 1356.8555   1393054   20.31397  8.609172   0.01    100  557.2216    41.06713
## 3     Alt Penedès  592.7758    488554   17.65630  9.036426   0.01    100  195.4216    32.96720
## 4      Alt Urgell 1447.2226   2516325   24.93210 14.876077   0.01    100 1006.5300    69.54908
## 5  Alta Ribagorça  427.2234    437735   27.79429 18.256835   0.01    100  175.0940    40.98418
## 6           Anoia  866.6878    976681   16.50647  8.703730   0.01    100  390.6724    45.07648
## 7           Bages 1092.7763   1455613   16.45591  8.884009   0.01    100  582.2452    53.28128
## 8       Baix Camp  697.0773    590955   16.72298  8.028576   0.01    100  236.3820    33.91044
## 9       Baix Ebre 1002.1005    558271   16.74180  9.326562   0.01    100  223.3084    22.28403
## 10   Baix Empordà  701.3843    862685   18.40010  8.052129   0.02    100  345.0740    49.19899
##                              geom
## 1  MULTIPOLYGON (((1.495952 41...
## 2  MULTIPOLYGON (((3.170083 42...
## 3  MULTIPOLYGON (((1.837855 41...
## 4  MULTIPOLYGON (((1.319412 41...
## 5  MULTIPOLYGON (((0.9378095 4...
## 6  MULTIPOLYGON (((1.47133 41....
## 7  MULTIPOLYGON (((2.040477 41...
## 8  MULTIPOLYGON (((1.06411 41....
## 9  MULTIPOLYGON (((0.5591292 4...
## 10 MULTIPOLYGON (((3.170083 42...
```

---

## quickly plot


```r
plot(lidar_data)
```

&lt;img src="index_files/figure-html/quick_plot-1.png" style="display: block; margin: auto;" /&gt;

---

## it's a dataframe (tibble)!!!


```r
library(dplyr)
valles_data &lt;- lidar_data %&gt;%
  filter(poly_id == "Vallès Occidental")
valles_data
```

```
## Simple feature collection with 1 feature and 9 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 1.860982 ymin: 41.41498 xmax: 2.224695 ymax: 41.71742
## Geodetic CRS:  WGS 84
##             poly_id poly_km2 AB_pixels AB_average    AB_sd AB_min AB_max  AB_km2 AB_km2_perc
## 1 Vallès Occidental 582.9532    659060   20.60493 8.976501   0.01    100 263.624    45.22216
##                             geom
## 1 MULTIPOLYGON (((2.133049 41...
```

---

## save it





```r
st_write(valles_data, 'valles_data.gpkg')
```

```
## Writing layer `valles_data' to data source `valles_data.gpkg' using driver `GPKG'
## Writing 1 features with 9 fields and geometry type Multi Polygon.
```

```r
file.exists('valles_data.gpkg')
```

```
## [1] TRUE
```

---

## Back to read, but with a twist


```r
valles_wkt &lt;- st_read('valles_data.gpkg', quiet = TRUE) %&gt;%
  st_geometry() %&gt;%
  st_as_text()

valles_data_2 &lt;- st_read('lidar_data.gpkg', wkt_filter = valles_wkt, quiet = TRUE)
valles_data_2
```

```
## Simple feature collection with 6 features and 9 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 1.551508 ymin: 41.26331 xmax: 2.60935 ymax: 41.9704
## Geodetic CRS:  WGS 84
##             poly_id  poly_km2 AB_pixels AB_average     AB_sd AB_min AB_max   AB_km2 AB_km2_perc
## 1             Bages 1092.7763   1455613   16.45591  8.884009   0.01 100.00 582.2452    53.28128
## 2    Baix Llobregat  487.8669    397595   19.63158  9.438929   0.01 100.00 159.0380    32.59864
## 3        Barcelonès  146.1943     43138   20.21294  7.832255   0.06  72.39  17.2552    11.80292
## 4 Vallès Occidental  582.9532    659060   20.60493  8.976501   0.01 100.00 263.6240    45.22216
## 5   Vallès Oriental  735.2148   1103493   23.07162  8.838574   0.01 100.00 441.3972    60.03649
## 6           Moianès  337.5398    593580   20.80658 10.609974   0.04 100.00 237.4320    70.34192
##                             geom
## 1 MULTIPOLYGON (((2.040477 41...
## 2 MULTIPOLYGON (((1.812835 41...
## 3 MULTIPOLYGON (((2.059358 41...
## 4 MULTIPOLYGON (((2.133049 41...
## 5 MULTIPOLYGON (((2.41841 41....
## 6 MULTIPOLYGON (((2.240584 41...
```

---

## Coordinate Reference System (crs)

CRS is a framework used to precisely measure locations on the surface of the
Earth as coordinates.



```r
st_crs(lidar_data)
```

```
## Coordinate Reference System:
##   User input: WGS 84 
##   wkt:
## GEOGCRS["WGS 84",
##     ENSEMBLE["World Geodetic System 1984 ensemble",
##         MEMBER["World Geodetic System 1984 (Transit)"],
##         MEMBER["World Geodetic System 1984 (G730)"],
##         MEMBER["World Geodetic System 1984 (G873)"],
##         MEMBER["World Geodetic System 1984 (G1150)"],
##         MEMBER["World Geodetic System 1984 (G1674)"],
##         MEMBER["World Geodetic System 1984 (G1762)"],
##         MEMBER["World Geodetic System 1984 (G2139)"],
##         ELLIPSOID["WGS 84",6378137,298.257223563,
##             LENGTHUNIT["metre",1]],
##         ENSEMBLEACCURACY[2.0]],
##     PRIMEM["Greenwich",0,
##         ANGLEUNIT["degree",0.0174532925199433]],
##     CS[ellipsoidal,2],
##         AXIS["geodetic latitude (Lat)",north,
##             ORDER[1],
##             ANGLEUNIT["degree",0.0174532925199433]],
##         AXIS["geodetic longitude (Lon)",east,
##             ORDER[2],
##             ANGLEUNIT["degree",0.0174532925199433]],
##     USAGE[
##         SCOPE["Horizontal component of 3D system."],
##         AREA["World."],
##         BBOX[-90,-180,90,180]],
##     ID["EPSG",4326]]
```

---

## CRS transformations


```r
lidar_data_utm &lt;- st_transform(lidar_data, crs = 3043)
st_crs(lidar_data_utm)
```

```
## Coordinate Reference System:
##   User input: EPSG:3043 
##   wkt:
## PROJCRS["ETRS89 / UTM zone 31N (N-E)",
##     BASEGEOGCRS["ETRS89",
##         ENSEMBLE["European Terrestrial Reference System 1989 ensemble",
##             MEMBER["European Terrestrial Reference Frame 1989"],
##             MEMBER["European Terrestrial Reference Frame 1990"],
##             MEMBER["European Terrestrial Reference Frame 1991"],
##             MEMBER["European Terrestrial Reference Frame 1992"],
##             MEMBER["European Terrestrial Reference Frame 1993"],
##             MEMBER["European Terrestrial Reference Frame 1994"],
##             MEMBER["European Terrestrial Reference Frame 1996"],
##             MEMBER["European Terrestrial Reference Frame 1997"],
##             MEMBER["European Terrestrial Reference Frame 2000"],
##             MEMBER["European Terrestrial Reference Frame 2005"],
##             MEMBER["European Terrestrial Reference Frame 2014"],
##             ELLIPSOID["GRS 1980",6378137,298.257222101,
##                 LENGTHUNIT["metre",1]],
##             ENSEMBLEACCURACY[0.1]],
##         PRIMEM["Greenwich",0,
##             ANGLEUNIT["degree",0.0174532925199433]],
##         ID["EPSG",4258]],
##     CONVERSION["UTM zone 31N",
##         METHOD["Transverse Mercator",
##             ID["EPSG",9807]],
##         PARAMETER["Latitude of natural origin",0,
##             ANGLEUNIT["degree",0.0174532925199433],
##             ID["EPSG",8801]],
##         PARAMETER["Longitude of natural origin",3,
##             ANGLEUNIT["degree",0.0174532925199433],
##             ID["EPSG",8802]],
##         PARAMETER["Scale factor at natural origin",0.9996,
##             SCALEUNIT["unity",1],
##             ID["EPSG",8805]],
##         PARAMETER["False easting",500000,
##             LENGTHUNIT["metre",1],
##             ID["EPSG",8806]],
##         PARAMETER["False northing",0,
##             LENGTHUNIT["metre",1],
##             ID["EPSG",8807]]],
##     CS[Cartesian,2],
##         AXIS["northing (N)",north,
##             ORDER[1],
##             LENGTHUNIT["metre",1]],
##         AXIS["easting (E)",east,
##             ORDER[2],
##             LENGTHUNIT["metre",1]],
##     USAGE[
##         SCOPE["Pan-European medium scale conformal mapping."],
##         AREA["Europe between 0°E and 6°E: Andorra; Belgium - onshore and offshore; Denmark - offshore; Germany - offshore; Jan Mayen - offshore; Norway including Svalbard - onshore and offshore; Spain - onshore and offshore."],
##         BBOX[37,0,82.45,6.01]],
##     ID["EPSG",3043]]
```

---

## CRS transformations


```r
valles_data_utm &lt;- st_transform(valles_data, crs = st_crs(lidar_data_utm))
st_crs(valles_data_utm)
```

```
## Coordinate Reference System:
##   User input: EPSG:3043 
##   wkt:
## PROJCRS["ETRS89 / UTM zone 31N (N-E)",
##     BASEGEOGCRS["ETRS89",
##         ENSEMBLE["European Terrestrial Reference System 1989 ensemble",
##             MEMBER["European Terrestrial Reference Frame 1989"],
##             MEMBER["European Terrestrial Reference Frame 1990"],
##             MEMBER["European Terrestrial Reference Frame 1991"],
##             MEMBER["European Terrestrial Reference Frame 1992"],
##             MEMBER["European Terrestrial Reference Frame 1993"],
##             MEMBER["European Terrestrial Reference Frame 1994"],
##             MEMBER["European Terrestrial Reference Frame 1996"],
##             MEMBER["European Terrestrial Reference Frame 1997"],
##             MEMBER["European Terrestrial Reference Frame 2000"],
##             MEMBER["European Terrestrial Reference Frame 2005"],
##             MEMBER["European Terrestrial Reference Frame 2014"],
##             ELLIPSOID["GRS 1980",6378137,298.257222101,
##                 LENGTHUNIT["metre",1]],
##             ENSEMBLEACCURACY[0.1]],
##         PRIMEM["Greenwich",0,
##             ANGLEUNIT["degree",0.0174532925199433]],
##         ID["EPSG",4258]],
##     CONVERSION["UTM zone 31N",
##         METHOD["Transverse Mercator",
##             ID["EPSG",9807]],
##         PARAMETER["Latitude of natural origin",0,
##             ANGLEUNIT["degree",0.0174532925199433],
##             ID["EPSG",8801]],
##         PARAMETER["Longitude of natural origin",3,
##             ANGLEUNIT["degree",0.0174532925199433],
##             ID["EPSG",8802]],
##         PARAMETER["Scale factor at natural origin",0.9996,
##             SCALEUNIT["unity",1],
##             ID["EPSG",8805]],
##         PARAMETER["False easting",500000,
##             LENGTHUNIT["metre",1],
##             ID["EPSG",8806]],
##         PARAMETER["False northing",0,
##             LENGTHUNIT["metre",1],
##             ID["EPSG",8807]]],
##     CS[Cartesian,2],
##         AXIS["northing (N)",north,
##             ORDER[1],
##             LENGTHUNIT["metre",1]],
##         AXIS["easting (E)",east,
##             ORDER[2],
##             LENGTHUNIT["metre",1]],
##     USAGE[
##         SCOPE["Pan-European medium scale conformal mapping."],
##         AREA["Europe between 0°E and 6°E: Andorra; Belgium - onshore and offshore; Denmark - offshore; Germany - offshore; Jan Mayen - offshore; Norway including Svalbard - onshore and offshore; Spain - onshore and offshore."],
##         BBOX[37,0,82.45,6.01]],
##     ID["EPSG",3043]]
```

---

## Geometrical operations


```r
lidar_centroids &lt;- st_centroid(lidar_data)
```

```
## Warning in st_centroid.sf(lidar_data): st_centroid assumes attributes are constant over geometries
## of x
```

```r
lidar_centroids
```

```
## Simple feature collection with 42 features and 9 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: 0.3723986 ymin: 40.66646 xmax: 3.065064 ymax: 42.72576
## Geodetic CRS:  WGS 84
## First 10 features:
##           poly_id  poly_km2 AB_pixels AB_average     AB_sd AB_min AB_max    AB_km2 AB_km2_perc
## 1        Alt Camp  537.6352    482120   16.69471  8.207308   0.01    100  192.8480    35.86968
## 2     Alt Empordà 1356.8555   1393054   20.31397  8.609172   0.01    100  557.2216    41.06713
## 3     Alt Penedès  592.7758    488554   17.65630  9.036426   0.01    100  195.4216    32.96720
## 4      Alt Urgell 1447.2226   2516325   24.93210 14.876077   0.01    100 1006.5300    69.54908
## 5  Alta Ribagorça  427.2234    437735   27.79429 18.256835   0.01    100  175.0940    40.98418
## 6           Anoia  866.6878    976681   16.50647  8.703730   0.01    100  390.6724    45.07648
## 7           Bages 1092.7763   1455613   16.45591  8.884009   0.01    100  582.2452    53.28128
## 8       Baix Camp  697.0773    590955   16.72298  8.028576   0.01    100  236.3820    33.91044
## 9       Baix Ebre 1002.1005    558271   16.74180  9.326562   0.01    100  223.3084    22.28403
## 10   Baix Empordà  701.3843    862685   18.40010  8.052129   0.02    100  345.0740    49.19899
##                          geom
## 1   POINT (1.308212 41.32804)
## 2   POINT (2.953762 42.30457)
## 3   POINT (1.697083 41.38776)
## 4   POINT (1.383795 42.27285)
## 5  POINT (0.8237439 42.48669)
## 6   POINT (1.583002 41.59802)
## 7    POINT (1.80552 41.78565)
## 8  POINT (0.9839632 41.13806)
## 9  POINT (0.5613804 40.84048)
## 10  POINT (3.065064 41.95732)
```

---

## Geometrical operations


```r
st_distance(lidar_centroids)
```

```
## Units: [m]
##            [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]      [,8]      [,9]
##  [1,]      0.00 174314.33  33128.47 105244.58 134929.26  37755.45  65584.62  34372.85  82807.54
##  [2,] 174314.33      0.00 145696.83 129188.84 176077.15 137919.43 110992.51 208680.25 257100.64
##  [3,]  33128.47 145696.83      0.00 101782.89 141949.46  25236.31  45152.79  65755.23 112938.51
##  [4,] 105244.58 129188.84 101782.89      0.00  51783.94  76826.23  64406.48 130475.78 173348.15
##  [5,] 134929.26 176077.15 141949.46  51783.94      0.00 117028.01 112382.81 150548.53 184343.01
##  [6,]  37755.45 137919.43  25236.31  76826.23 117028.01      0.00  27868.78  71517.51 119984.97
##  [7,]  65584.62 110992.51  45152.79  64406.48 112382.81  27868.78      0.00  99357.13 147790.24
##  [8,]  34372.85 208680.25  65755.23 130475.78 150548.53  71517.51  99357.13      0.00  48506.54
##  [9,]  82807.54 257100.64 112938.51 173348.15 184343.01 119984.97 147790.24  48506.54      0.00
## [10,] 161886.69  39688.05 130077.99 143045.14 193714.08 129224.97 106022.80 195676.97 242952.31
## [11,]  55126.85 130087.62  22148.78 108522.83 153436.91  38683.57  45117.05  86696.30 132677.47
## [12,]  18601.41 165810.46  20146.67 112271.93 147134.84  37118.86  62401.15  46800.08  93099.20
## [13,]  72028.12 119128.83  39067.45 115818.40 163279.65  52804.91  51451.03 103158.83 148412.95
## [14,]  99289.79  93078.41  82859.62  41821.31  93537.39  62544.59  37818.78 131164.98 178597.15
## [15,] 124898.77  96050.33 111956.85  36006.80  80066.38  89964.67  67454.30 154682.40 200541.45
## [16,]  15322.24 173459.63  41317.26  93418.00 120294.38  35721.19  62654.00  38705.42  86103.97
## [17,]  39915.52 151448.36  15499.68 117027.45 157406.85  40715.29  58241.29  67846.02 112275.54
## [18,]  42498.67 201189.22  73318.28 103869.67 116580.72  65924.95  90545.99  36068.61  69921.14
## [19,] 139799.14  36344.61 112911.21  96041.19 145367.48 102750.72  75346.10 174047.73 222552.96
## [20,] 145131.78  38954.65 114102.51 124219.58 175193.52 111354.82  87322.92 179230.71 226989.10
## [21,] 106787.10  84880.14  73892.05 120503.51 171742.78  79100.02  63649.33 139508.37 185750.40
## [22,] 100294.25 274013.24 128783.15 193332.80 204229.07 137907.05 165775.66  66575.70  20120.95
## [23,]  71221.73 174024.05  86139.23  56777.87  65927.30  64539.43  74664.45  84666.95 121255.28
##           [,10]     [,11]     [,12]     [,13]     [,14]     [,15]     [,16]     [,17]     [,18]
##  [1,] 161886.69  55126.85  18601.41  72028.12  99289.79 124898.77  15322.24  39915.52  42498.67
##  [2,]  39688.05 130087.62 165810.46 119128.83  93078.41  96050.33 173459.63 151448.36 201189.22
##  [3,] 130077.99  22148.78  20146.67  39067.45  82859.62 111956.85  41317.26  15499.68  73318.28
##  [4,] 143045.14 108522.83 112271.93 115818.40  41821.31  36006.80  93418.00 117027.45 103869.67
##  [5,] 193714.08 153436.91 147134.84 163279.65  93537.39  80066.38 120294.38 157406.85 116580.72
##  [6,] 129224.97  38683.57  37118.86  52804.91  62544.59  89964.67  35721.19  40715.29  65924.95
##  [7,] 106022.80  45117.05  62401.15  51451.03  37818.78  67454.30  62654.00  58241.29  90545.99
##  [8,] 195676.97  86696.30  46800.08 103158.83 131164.98 154682.40  38705.42  67846.02  36068.61
##  [9,] 242952.31 132677.47  93099.20 148412.95 178597.15 200541.45  86103.97 112275.54  69921.14
## [10,]      0.00 110755.62 149859.95  96494.25 102031.28 115589.36 164502.73 132000.18 195085.07
## [11,] 110755.62      0.00  39934.78  16923.49  81364.51 111540.51  63174.25  21497.82  95321.83
## [12,] 149859.95  39934.78      0.00  56367.08  99157.23 127062.85  32308.73  21896.82  61067.84
## [13,]  96494.25  16923.49  56367.08      0.00  83705.71 113630.95  79921.01  36165.97 112120.01
## [14,] 102031.28  81364.51  99157.23  83705.71      0.00  30199.48  92612.19  96021.82 114478.21
## [15,] 115589.36 111540.51 127062.85 113630.95  30199.48      0.00 116065.28 125644.25 133040.09
## [16,] 164502.73  63174.25  32308.73  79921.01  92612.19 116065.28      0.00  51711.13  32235.76
## [17,] 132000.18  21497.82  21896.82  36165.97  96021.82 125644.25  51711.13      0.00  82280.92
## [18,] 195085.07  95321.83  61067.84 112120.01 114478.21 133040.09  32235.76  82280.92      0.00
## [19,]  49802.14  99798.23 132770.56  91646.86  57566.01  66157.04 137993.89 120511.44 165103.42
## [20,]  19295.20  96008.16 134134.33  83129.75  82962.19  97993.79 146889.56 117486.49 177005.11
## [21,]  58710.77  53078.37  92910.47  37910.42  80650.24 106664.07 111986.40  73838.45 143911.54
## [22,] 258143.35 147412.89 108673.58 162483.83 197559.25 220094.51 104947.10 126396.30  90031.97
## [23,] 177834.74 103169.62  85954.63 117058.64  81107.01  90639.17  56017.57 100614.37  51724.58
##           [,19]     [,20]     [,21]     [,22]     [,23]     [,24]     [,25]     [,26]     [,27]
##  [1,] 139799.14 145131.78 106787.10 100294.25  71221.73 106348.90 104320.21 135501.18  50757.91
##  [2,]  36344.61  38954.65  84880.14 274013.24 174024.05  68506.29 167211.72 148934.30 186913.56
##  [3,] 112911.21 114102.51  73892.05 128783.15  86139.23  79797.59 112664.85 135610.94  74460.59
##  [4,]  96041.19 124219.58 120503.51 193332.80  56777.87  79132.67  38202.86  34793.09  81396.38
##  [5,] 145367.48 175193.52 171742.78 204229.07  65927.30 130877.39  30625.89  28885.95  93427.88
##  [6,] 102750.72 111354.82  79100.02 137907.05  64539.43  69488.44  88169.72 110430.47  59301.70
##  [7,]  75346.10  87322.92  63649.33 165775.66  74664.45  42541.23  87435.30  99180.58  78945.58
##  [8,] 174047.73 179230.71 139508.37  66575.70  84666.95 140627.75 120584.73 156872.87  57377.87
##  [9,] 222552.96 226989.10 185750.40  20120.95 121255.28 189126.92 156525.05 195807.35  93407.50
## [10,]  49802.14  19295.20  58710.77 258143.35 177834.74  67099.36 179027.47 169137.79 184968.25
## [11,]  99798.23  96008.16  53078.37 147412.89 103169.62  68414.99 125680.72 143247.46  94881.84
## [12,] 132770.56 134134.33  92910.47 108673.58  85954.63  99501.35 116829.01 144578.29  68216.32
## [13,]  91646.86  83129.75  37910.42 162483.83 117058.64  63133.58 136831.67 150556.31 110768.99
## [14,]  57566.01  82962.19  80650.24 197559.25  81107.01  37342.57  77014.77  72828.33  96744.54
## [15,]  66157.04  97993.79 106664.07 220094.51  90639.17  60246.58  73708.09  53750.50 112322.68
## [16,] 137993.89 146889.56 111986.40 104947.10  56017.57 104959.06  89669.36 122254.20  35921.93
## [17,] 120511.44 117486.49  73838.45 126396.30 100614.37  88344.91 128014.05 151000.87  86743.25
## [18,] 165103.42 177005.11 143911.54  90031.97  51724.58 132998.23  87531.81 126064.81  23641.64
## [19,]      0.00  33870.90  63955.55 239974.46 138052.97  33471.76 133429.10 119888.68 150571.63
## [20,]  33870.90      0.00  46859.65 242776.35 158602.86  47810.50 159902.37 151186.23 166222.61
## [21,]  63955.55  46859.65      0.00 200233.48 137984.31  46756.16 149630.15 153317.33 138173.84
## [22,] 239974.46 242776.35 200233.48      0.00 141366.88 206503.11 176580.70 215924.14 113528.40
## [23,] 138052.97 158602.86 137984.31 141366.88      0.00 110897.50  36008.42  74573.37  28101.85
##           [,28]     [,29]     [,30]     [,31]     [,32]     [,33]     [,34]     [,35]     [,36]
##  [1,] 151359.11  43295.60  61794.65 130706.73  46096.09  69774.95 125537.38  78344.39  18373.71
##  [2,]  24209.00 214813.69 233682.96  59831.12 148643.35 216694.74  57025.58 122490.87 187826.22
##  [3,] 122040.34  76371.35  94676.68 108840.41  50344.15  99020.91  94119.48  71234.14  42546.93
##  [4,] 116673.65 126387.86 141886.74  69373.61  59201.70 105908.72 115001.49  30835.78 123598.67
##  [5,] 166295.18 140883.26 151538.57 117437.46  92360.66 105595.03 166721.71  77720.24 151969.20
##  [6,] 115630.66  76933.86  95832.09  92981.03  27046.13  87547.16  92756.86  46615.45  54336.74
##  [7,]  89474.29 104040.51 122842.01  65385.43  40468.05 108688.40  70372.82  34730.99  81652.33
##  [8,] 185722.93  17118.82  30784.70 163905.83  72846.29  60418.44 159482.86 107185.28  25307.76
##  [9,] 234016.70  47067.78  32815.94 211997.98 118691.16  80289.43 207054.51 153078.78  70516.06
## [10,]  29679.36 204641.18 223449.47  78064.00 146414.31 214678.55  36521.10 127853.05 172443.13
## [11,] 105977.10  98200.69 116270.30 100955.09  65724.97 120592.67  75773.27  77849.80  62318.06
## [12,] 142182.62  59225.71  76753.42 127374.85  55203.00  88373.15 114087.05  83020.19  22583.88
## [13,]  94927.34 115023.63 132979.64  97391.08  79374.09 137095.09  63021.18  86019.83  78439.37
## [14,]  77199.49 132542.92 150556.03  35735.98  60961.86 125834.61  73189.51  29840.49 116678.01
## [15,]  87095.93 153619.86 170598.69  37812.67  81999.78 139125.33  93564.52  47546.45 142907.20
## [16,] 151332.02  41389.57  60226.41 125948.68  34612.54  57797.90 127982.83  68651.43  31719.02
## [17,] 127379.48  81018.35  98239.93 119498.92  65564.34 109155.74  97247.31  86355.11  42718.22
## [18,] 180019.18  24312.64  38017.25 149658.37  53641.40  27727.64 158656.07  86475.63  49322.76
## [19,]  20964.01 179383.02 198187.42  28389.43 112349.03 180350.22  38771.42  86521.49 154235.24
## [20,]  18146.82 187464.68 206341.96  61121.44 127586.15 196006.19  20241.75 108558.41 156644.61
## [21,]  61240.58 150074.02 168527.79  79304.07 101865.67 166638.85  27941.79  95445.04 115379.15
## [22,] 250631.44  66958.77  52819.82 230480.34 138131.88  99645.68 222676.29 172574.03  86293.46
## [23,] 156502.59  75916.41  88682.63 116292.12  37684.67  49144.80 143723.09  51543.27  87163.01
##           [,37]     [,38]     [,39]     [,40]     [,41]     [,42]
##  [1,]  84005.36  39807.20 160395.24  67374.83  93893.29  83024.41
##  [2,] 255482.00 170834.64 180389.73 111023.60  87150.09  91290.75
##  [3,] 116825.83  58313.86 165165.63  35543.51  61928.75  55804.46
##  [4,] 159410.40  73960.53  67900.86  96214.27 103937.03  78292.99
##  [5,] 163593.82  96040.52  26586.19 144237.21 154889.38 129058.87
##  [6,] 117777.06  41562.52 139980.82  39206.35  63453.11  47142.60
##  [7,] 144529.59  61642.47 131894.71  31982.80  46356.94  23103.50
##  [8,]  52083.12  57063.91 177014.62 101013.39 127535.13 117389.55
##  [9,]  28603.22  99708.85 210798.37 148472.42 174844.07 165819.71
## [10,] 245658.15 167587.30 202718.69  94663.69  68157.79  83158.68
## [11,] 138317.40  77918.84 174891.00  20089.42  43494.43  45689.85
## [12,]  98638.13  55128.76 171770.70  55578.24  81793.62  75533.14
## [13,] 154962.54  93480.35 183330.37  19708.87  32218.07  43787.76
## [14,] 171020.78  82610.37 107283.71  64407.32  65089.77  41092.42
## [15,] 189694.43 101378.15  87140.55  94498.27  92570.34  70350.69
## [16,]  82080.19  24614.90 146013.24  71669.78  97565.70  82863.29
## [17,] 119912.39  71623.28 180664.98  40685.41  64991.67  64775.41
## [18,]  56783.64  31978.24 143165.47 103543.76 129046.55 112368.95
## [19,] 219832.40 134556.91 153143.46  79886.59  59808.42  57269.64
## [20,] 228503.06 148961.94 185069.14  78565.70  52571.68  64707.95
## [21,] 190700.99 120358.90 187661.83  40368.61  17347.77  42959.96
## [22,]  44378.35 119572.63 230640.48 164245.74 190320.01 182913.58
## [23,] 104169.30  31417.26  92350.88 101232.47 120838.80  97286.33
##  [ reached getOption("max.print") -- omitted 19 rows ]
```

---

## Geometrical operations


```r
st_distance(lidar_centroids[1,], lidar_centroids[42,])
```

```
## Units: [m]
##          [,1]
## [1,] 83024.41
```

---

## Geometrical operations


```r
st_intersects(lidar_centroids, lidar_data)
```

```
## Sparse geometry binary predicate list of length 42, where the predicate was `intersects'
## first 10 elements:
##  1: 1
##  2: 2
##  3: 3
##  4: 4
##  5: 5
##  6: 6
##  7: 7
##  8: 8
##  9: 9
##  10: 10
```

---

## Geometrical operations


```r
st_intersects(lidar_centroids, lidar_data, sparse = FALSE)
```

```
##        [,1]  [,2]  [,3]  [,4]  [,5]  [,6]  [,7]  [,8]  [,9] [,10] [,11] [,12] [,13] [,14] [,15]
##  [1,]  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [2,] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [3,] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [4,] FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [5,] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [6,] FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [7,] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [8,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [9,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
## [10,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE
## [11,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE
## [12,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE
## [13,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE
## [14,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE
## [15,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE
## [16,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [17,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [18,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [19,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [20,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [21,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [22,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [23,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##       [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24] [,25] [,26] [,27] [,28] [,29] [,30]
##  [1,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [2,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [3,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [4,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [5,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [6,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [7,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [8,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [9,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [10,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [11,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [12,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [13,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [14,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [15,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [16,]  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [17,] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [18,] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [19,] FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [20,] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [21,] FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [22,] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [23,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##       [,31] [,32] [,33] [,34] [,35] [,36] [,37] [,38] [,39] [,40] [,41] [,42]
##  [1,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [2,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [3,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [4,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [5,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [6,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [7,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [8,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [9,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [10,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [11,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [12,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [13,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [14,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [15,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [16,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [17,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [18,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [19,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [20,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [21,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [22,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [23,] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [ reached getOption("max.print") -- omitted 19 rows ]
```

---

## Geometrical operations

  - `st_intersects`
  - `st_touches`
  - `st_within`
  - `st_contains`
  - `st_overlaps`
  - `st_covers`
  - ...

All these returns a matrix (sparse or not) with all comparisions

---

## Geometrical operations


```r
st_buffer(lidar_centroids, 1000)
```

```
## Simple feature collection with 42 features and 9 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 0.3604196 ymin: 40.65741 xmax: 3.077187 ymax: 42.73487
## Geodetic CRS:  WGS 84
## First 10 features:
##           poly_id  poly_km2 AB_pixels AB_average     AB_sd AB_min AB_max    AB_km2 AB_km2_perc
## 1        Alt Camp  537.6352    482120   16.69471  8.207308   0.01    100  192.8480    35.86968
## 2     Alt Empordà 1356.8555   1393054   20.31397  8.609172   0.01    100  557.2216    41.06713
## 3     Alt Penedès  592.7758    488554   17.65630  9.036426   0.01    100  195.4216    32.96720
## 4      Alt Urgell 1447.2226   2516325   24.93210 14.876077   0.01    100 1006.5300    69.54908
## 5  Alta Ribagorça  427.2234    437735   27.79429 18.256835   0.01    100  175.0940    40.98418
## 6           Anoia  866.6878    976681   16.50647  8.703730   0.01    100  390.6724    45.07648
## 7           Bages 1092.7763   1455613   16.45591  8.884009   0.01    100  582.2452    53.28128
## 8       Baix Camp  697.0773    590955   16.72298  8.028576   0.01    100  236.3820    33.91044
## 9       Baix Ebre 1002.1005    558271   16.74180  9.326562   0.01    100  223.3084    22.28403
## 10   Baix Empordà  701.3843    862685   18.40010  8.052129   0.02    100  345.0740    49.19899
##                              geom
## 1  POLYGON ((1.318023 41.32289...
## 2  POLYGON ((2.957717 42.29601...
## 3  POLYGON ((1.706144 41.39368...
## 4  POLYGON ((1.395169 42.27603...
## 5  POLYGON ((0.8209189 42.4954...
## 6  POLYGON ((1.576575 41.59026...
## 7  POLYGON ((1.817664 41.78565...
## 8  POLYGON ((0.9911792 41.1308...
## 9  POLYGON ((0.5521907 40.8462...
## 10 POLYGON ((3.072803 41.9504,...
```

---

## Geometrical operations


```r
convex_hull_counties &lt;- st_convex_hull(lidar_data)
convex_hull_counties
```

```
## Simple feature collection with 42 features and 9 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 0.1626252 ymin: 40.52296 xmax: 3.321198 ymax: 42.86144
## Geodetic CRS:  WGS 84
## First 10 features:
##           poly_id  poly_km2 AB_pixels AB_average     AB_sd AB_min AB_max    AB_km2 AB_km2_perc
## 1        Alt Camp  537.6352    482120   16.69471  8.207308   0.01    100  192.8480    35.86968
## 2     Alt Empordà 1356.8555   1393054   20.31397  8.609172   0.01    100  557.2216    41.06713
## 3     Alt Penedès  592.7758    488554   17.65630  9.036426   0.01    100  195.4216    32.96720
## 4      Alt Urgell 1447.2226   2516325   24.93210 14.876077   0.01    100 1006.5300    69.54908
## 5  Alta Ribagorça  427.2234    437735   27.79429 18.256835   0.01    100  175.0940    40.98418
## 6           Anoia  866.6878    976681   16.50647  8.703730   0.01    100  390.6724    45.07648
## 7           Bages 1092.7763   1455613   16.45591  8.884009   0.01    100  582.2452    53.28128
## 8       Baix Camp  697.0773    590955   16.72298  8.028576   0.01    100  236.3820    33.91044
## 9       Baix Ebre 1002.1005    558271   16.74180  9.326562   0.01    100  223.3084    22.28403
## 10   Baix Empordà  701.3843    862685   18.40010  8.052129   0.02    100  345.0740    49.19899
##                              geom
## 1  POLYGON ((1.259028 41.19964...
## 2  POLYGON ((3.132064 42.09831...
## 3  POLYGON ((1.623316 41.22259...
## 4  POLYGON ((1.251535 41.93942...
## 5  POLYGON ((0.8738718 42.2987...
## 6  POLYGON ((1.50262 41.42846,...
## 7  POLYGON ((1.851815 41.59091...
## 8  POLYGON ((0.857773 40.93525...
## 9  POLYGON ((0.7920713 40.6942...
## 10 POLYGON ((2.971151 41.75308...
```

---

## Geometrical operations


```r
plot(convex_hull_counties)
```

&lt;img src="index_files/figure-html/convex_hull_2-1.png" style="display: block; margin: auto;" /&gt;

---

## Geometrical operations


```r
lidar_centroids_multipoint &lt;- st_union(lidar_centroids)
lidar_centroids_multipoint
```

```
## Geometry set for 1 feature 
## Geometry type: MULTIPOINT
## Dimension:     XY
## Bounding box:  xmin: 0.3723986 ymin: 40.66646 xmax: 3.065064 ymax: 42.72576
## Geodetic CRS:  WGS 84
```

```
## MULTIPOINT ((0.3723986 41.05448), (0.5613804 40...
```

---

## Geometrical operations


```r
convex_hull_centroids &lt;- st_convex_hull(lidar_centroids_multipoint)
plot(convex_hull_centroids)
plot(lidar_centroids, add = TRUE)
```

```
## Warning in plot.sf(lidar_centroids, add = TRUE): ignoring all but the first attribute
```

&lt;img src="index_files/figure-html/convex_hull_3-1.png" style="display: block; margin: auto;" /&gt;


---

## Geometrical operations


```r
# error
st_triangulate(lidar_centroids)
```

```
## Warning in st_triangulate.sfc(st_geometry(x), dTolerance, bOnlyEdges): st_triangulate does not
## correctly triangulate longitude/latitude data
```

```
## Simple feature collection with 42 features and 9 fields (with 42 geometries empty)
## Geometry type: GEOMETRYCOLLECTION
## Dimension:     XY
## Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
## Geodetic CRS:  WGS 84
## First 10 features:
##           poly_id  poly_km2 AB_pixels AB_average     AB_sd AB_min AB_max    AB_km2 AB_km2_perc
## 1        Alt Camp  537.6352    482120   16.69471  8.207308   0.01    100  192.8480    35.86968
## 2     Alt Empordà 1356.8555   1393054   20.31397  8.609172   0.01    100  557.2216    41.06713
## 3     Alt Penedès  592.7758    488554   17.65630  9.036426   0.01    100  195.4216    32.96720
## 4      Alt Urgell 1447.2226   2516325   24.93210 14.876077   0.01    100 1006.5300    69.54908
## 5  Alta Ribagorça  427.2234    437735   27.79429 18.256835   0.01    100  175.0940    40.98418
## 6           Anoia  866.6878    976681   16.50647  8.703730   0.01    100  390.6724    45.07648
## 7           Bages 1092.7763   1455613   16.45591  8.884009   0.01    100  582.2452    53.28128
## 8       Baix Camp  697.0773    590955   16.72298  8.028576   0.01    100  236.3820    33.91044
## 9       Baix Ebre 1002.1005    558271   16.74180  9.326562   0.01    100  223.3084    22.28403
## 10   Baix Empordà  701.3843    862685   18.40010  8.052129   0.02    100  345.0740    49.19899
##                        geom
## 1  GEOMETRYCOLLECTION EMPTY
## 2  GEOMETRYCOLLECTION EMPTY
## 3  GEOMETRYCOLLECTION EMPTY
## 4  GEOMETRYCOLLECTION EMPTY
## 5  GEOMETRYCOLLECTION EMPTY
## 6  GEOMETRYCOLLECTION EMPTY
## 7  GEOMETRYCOLLECTION EMPTY
## 8  GEOMETRYCOLLECTION EMPTY
## 9  GEOMETRYCOLLECTION EMPTY
## 10 GEOMETRYCOLLECTION EMPTY
```

---

## Geometrical operations


```r
# no error, but maybe lat long is not the perfect here
st_triangulate(lidar_centroids_multipoint)
```

```
## Warning in st_triangulate.sfc(lidar_centroids_multipoint): st_triangulate does not correctly
## triangulate longitude/latitude data
```

```
## Geometry set for 1 feature 
## Geometry type: GEOMETRYCOLLECTION
## Dimension:     XY
## Bounding box:  xmin: 0.3723986 ymin: 40.66646 xmax: 3.065064 ymax: 42.72576
## Geodetic CRS:  WGS 84
```

```
## GEOMETRYCOLLECTION (POLYGON ((0.8282611 42.7257...
```

---

## Geometrical operations


```r
# utm works fine
lidar_centroids_multipoint %&gt;%
  st_transform(crs = 3043) %&gt;%
  st_triangulate()
```

```
## Geometry set for 1 feature 
## Geometry type: GEOMETRYCOLLECTION
## Dimension:     XY
## Bounding box:  xmin: 279186 ymin: 4504747 xmax: 505392 ymax: 4732649
## Projected CRS: ETRS89 / UTM zone 31N (N-E)
```

```
## GEOMETRYCOLLECTION (POLYGON ((322196.5 4732649,...
```

---

## Geometrical operations


```r
# ummm, no plot???
lidar_centroids_multipoint %&gt;%
  st_transform(crs = 3043) %&gt;%
  st_triangulate() %&gt;%
  plot()
```

&lt;img src="index_files/figure-html/triangulate_4-1.png" style="display: block; margin: auto;" /&gt;

---

## Geometrical operations


```r
# ahh, we need to extract the collection, to be able to plot correctly
lidar_centroids_multipoint %&gt;%
  st_transform(crs = 3043) %&gt;%
  st_triangulate() %&gt;%
  st_collection_extract() %&gt;%
  plot()
```

&lt;img src="index_files/figure-html/triangulate_5-1.png" style="display: block; margin: auto;" /&gt;

---

## Geometrical operations


```r
# Is the same for voronoi polygons
lidar_centroids_multipoint %&gt;%
  st_transform(crs = 3043) %&gt;%
  st_voronoi() %&gt;%
  st_collection_extract() %&gt;%
  plot()
```

&lt;img src="index_files/figure-html/voronoi-1.png" style="display: block; margin: auto;" /&gt;


---

## Valid geometries


```r
sleeve_polygon &lt;- st_polygon(list(cbind(c(0,1,1,1,0,0),c(0,0,1,0.6,1,0))))
cross_polygon &lt;- st_polygon(list(cbind(c(0,1,0,1,0),c(0,1,1,0,0))))
st_is_valid(sleeve_polygon)
```

```
## [1] FALSE
```

```r
st_is_valid(cross_polygon)
```

```
## [1] FALSE
```

```r
st_is_valid(lidar_data[1,])
```

```
## [1] TRUE
```

---

## Valid geometries


```r
valid_sleeve_polygon &lt;- st_make_valid(sleeve_polygon)
valid_cross_polygon &lt;- st_make_valid(cross_polygon)
st_is_valid(valid_sleeve_polygon)
```

```
## [1] TRUE
```

```r
st_is_valid(valid_cross_polygon)
```

```
## [1] TRUE
```

---

## Valid geometries

.pull-left[

Invalid:

&lt;img src="index_files/figure-html/unnamed-chunk-2-1.png" style="display: block; margin: auto;" /&gt;&lt;img src="index_files/figure-html/unnamed-chunk-2-2.png" style="display: block; margin: auto;" /&gt;
]

.pull-right[

Valid:

&lt;img src="index_files/figure-html/unnamed-chunk-3-1.png" style="display: block; margin: auto;" /&gt;&lt;img src="index_files/figure-html/unnamed-chunk-3-2.png" style="display: block; margin: auto;" /&gt;
]

---

## Subsetting features


```r
lidar_data[1, "AB_average"]
```

```
## Simple feature collection with 1 feature and 1 field
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 1.042872 ymin: 41.19964 xmax: 1.537018 ymax: 41.47907
## Geodetic CRS:  WGS 84
##   AB_average                           geom
## 1   16.69471 MULTIPOLYGON (((1.495952 41...
```

---

## Subsetting features


```r
lidar_data[1, "AB_average", drop = TRUE]
```

```
## [1] 16.69471
## attr(,"class")
## [1] "numeric"
```

---

## Subsetting features


```r
lidar_data[valles_data,]
```

```
## Simple feature collection with 6 features and 9 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 1.551508 ymin: 41.26331 xmax: 2.60935 ymax: 41.9704
## Geodetic CRS:  WGS 84
##              poly_id  poly_km2 AB_pixels AB_average     AB_sd AB_min AB_max   AB_km2 AB_km2_perc
## 7              Bages 1092.7763   1455613   16.45591  8.884009   0.01 100.00 582.2452    53.28128
## 11    Baix Llobregat  487.8669    397595   19.63158  9.438929   0.01 100.00 159.0380    32.59864
## 13        Barcelonès  146.1943     43138   20.21294  7.832255   0.06  72.39  17.2552    11.80292
## 40 Vallès Occidental  582.9532    659060   20.60493  8.976501   0.01 100.00 263.6240    45.22216
## 41   Vallès Oriental  735.2148   1103493   23.07162  8.838574   0.01 100.00 441.3972    60.03649
## 42           Moianès  337.5398    593580   20.80658 10.609974   0.04 100.00 237.4320    70.34192
##                              geom
## 7  MULTIPOLYGON (((2.040477 41...
## 11 MULTIPOLYGON (((1.812835 41...
## 13 MULTIPOLYGON (((2.059358 41...
## 40 MULTIPOLYGON (((2.133049 41...
## 41 MULTIPOLYGON (((2.41841 41....
## 42 MULTIPOLYGON (((2.240584 41...
```

---

## Subsetting features


```r
lidar_data[valles_data, , op = st_contains]
```

```
## Simple feature collection with 1 feature and 9 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 1.860982 ymin: 41.41498 xmax: 2.224695 ymax: 41.71742
## Geodetic CRS:  WGS 84
##              poly_id poly_km2 AB_pixels AB_average    AB_sd AB_min AB_max  AB_km2 AB_km2_perc
## 40 Vallès Occidental 582.9532    659060   20.60493 8.976501   0.01    100 263.624    45.22216
##                              geom
## 40 MULTIPOLYGON (((2.133049 41...
```

---

## Subsetting features


```r
lidar_data %&gt;%
  filter(lengths(st_contains(., valles_data)) &gt; 0)
```

```
## Simple feature collection with 1 feature and 9 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 1.860982 ymin: 41.41498 xmax: 2.224695 ymax: 41.71742
## Geodetic CRS:  WGS 84
##             poly_id poly_km2 AB_pixels AB_average    AB_sd AB_min AB_max  AB_km2 AB_km2_perc
## 1 Vallès Occidental 582.9532    659060   20.60493 8.976501   0.01    100 263.624    45.22216
##                             geom
## 1 MULTIPOLYGON (((2.133049 41...
```

---

## Joining feature sets


```r
ifn_ab &lt;- st_read('ifn_data.gpkg', quiet = TRUE) %&gt;%
  as.data.frame() %&gt;%
  select(admin_region, basal_area_mean, -geom)
ifn_ab
```

```
##         admin_region basal_area_mean
## 1           Alt Camp       17.544107
## 2        Alt Empordà       21.923531
## 3        Alt Penedès       13.765320
## 4         Alt Urgell       23.879636
## 5     Alta Ribagorça       23.904747
## 6              Anoia       13.887243
## 7              Bages       12.416677
## 8          Baix Camp       16.573114
## 9          Baix Ebre       18.648741
## 10      Baix Empordà       20.289387
## 11    Baix Llobregat       13.527088
## 12      Baix Penedès       14.818076
## 13        Barcelonès       19.116235
## 14          Berguedà       20.890631
## 15          Cerdanya       27.223615
## 16  Conca de Barberà       16.863591
## 17            Garraf        9.667396
## 18         Garrigues       10.138431
## 19          Garrotxa       23.137891
## 20           Gironès       20.133531
## 21           Maresme       21.684917
## 22           Moianès       13.443483
## 23           Montsià       19.310749
## 24           Noguera       10.888007
## 25             Osona       19.595734
## 26     Pallars Jussà       18.364692
## 27    Pallars Sobirà       25.186011
## 28   Pla de l'Estany       21.601189
## 29           Priorat       12.091615
## 30     Ribera d'Ebre        9.695607
## 31          Ripollès       23.258395
## 32           Segarra        9.173423
## 33            Segrià        8.858439
## 34             Selva       19.978932
## 35          Solsonès       20.139305
## 36        Tarragonès       12.259485
## 37        Terra Alta       13.612180
## 38            Urgell       10.399826
## 39        Val d'Aran       30.794803
## 40 Vallès Occidental       18.435404
## 41   Vallès Oriental       20.843593
```

---

## Joining feature sets

By attributes


```r
left_join(lidar_data, ifn_ab, by = c("poly_id" = "admin_region"))
```

```
## Simple feature collection with 42 features and 10 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 0.1626252 ymin: 40.52296 xmax: 3.321198 ymax: 42.86144
## Geodetic CRS:  WGS 84
## First 10 features:
##           poly_id  poly_km2 AB_pixels AB_average     AB_sd AB_min AB_max    AB_km2 AB_km2_perc
## 1        Alt Camp  537.6352    482120   16.69471  8.207308   0.01    100  192.8480    35.86968
## 2     Alt Empordà 1356.8555   1393054   20.31397  8.609172   0.01    100  557.2216    41.06713
## 3     Alt Penedès  592.7758    488554   17.65630  9.036426   0.01    100  195.4216    32.96720
## 4      Alt Urgell 1447.2226   2516325   24.93210 14.876077   0.01    100 1006.5300    69.54908
## 5  Alta Ribagorça  427.2234    437735   27.79429 18.256835   0.01    100  175.0940    40.98418
## 6           Anoia  866.6878    976681   16.50647  8.703730   0.01    100  390.6724    45.07648
## 7           Bages 1092.7763   1455613   16.45591  8.884009   0.01    100  582.2452    53.28128
## 8       Baix Camp  697.0773    590955   16.72298  8.028576   0.01    100  236.3820    33.91044
## 9       Baix Ebre 1002.1005    558271   16.74180  9.326562   0.01    100  223.3084    22.28403
## 10   Baix Empordà  701.3843    862685   18.40010  8.052129   0.02    100  345.0740    49.19899
##    basal_area_mean                           geom
## 1         17.54411 MULTIPOLYGON (((1.495952 41...
## 2         21.92353 MULTIPOLYGON (((3.170083 42...
## 3         13.76532 MULTIPOLYGON (((1.837855 41...
## 4         23.87964 MULTIPOLYGON (((1.319412 41...
## 5         23.90475 MULTIPOLYGON (((0.9378095 4...
## 6         13.88724 MULTIPOLYGON (((1.47133 41....
## 7         12.41668 MULTIPOLYGON (((2.040477 41...
## 8         16.57311 MULTIPOLYGON (((1.06411 41....
## 9         18.64874 MULTIPOLYGON (((0.5591292 4...
## 10        20.28939 MULTIPOLYGON (((3.170083 42...
```

---

## Joining feature sets

By attributes


```r
left_join(lidar_data, ifn_ab, by = c("poly_id" = "admin_region")) %&gt;%
  select(poly_id, AB_lidar = AB_average, AB_ifn = basal_area_mean) %&gt;%
  mutate(difference = AB_ifn - AB_lidar)
```

```
## Simple feature collection with 42 features and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 0.1626252 ymin: 40.52296 xmax: 3.321198 ymax: 42.86144
## Geodetic CRS:  WGS 84
## First 10 features:
##           poly_id AB_lidar   AB_ifn                           geom difference
## 1        Alt Camp 16.69471 17.54411 MULTIPOLYGON (((1.495952 41...  0.8493953
## 2     Alt Empordà 20.31397 21.92353 MULTIPOLYGON (((3.170083 42...  1.6095620
## 3     Alt Penedès 17.65630 13.76532 MULTIPOLYGON (((1.837855 41... -3.8909755
## 4      Alt Urgell 24.93210 23.87964 MULTIPOLYGON (((1.319412 41... -1.0524606
## 5  Alta Ribagorça 27.79429 23.90475 MULTIPOLYGON (((0.9378095 4... -3.8895409
## 6           Anoia 16.50647 13.88724 MULTIPOLYGON (((1.47133 41.... -2.6192251
## 7           Bages 16.45591 12.41668 MULTIPOLYGON (((2.040477 41... -4.0392295
## 8       Baix Camp 16.72298 16.57311 MULTIPOLYGON (((1.06411 41.... -0.1498684
## 9       Baix Ebre 16.74180 18.64874 MULTIPOLYGON (((0.5591292 4...  1.9069363
## 10   Baix Empordà 18.40010 20.28939 MULTIPOLYGON (((3.170083 42...  1.8892824
```

---

## Joining fetarure sets

By geometries


```r
ifn_data &lt;- st_read('ifn_data.gpkg', quiet = TRUE) %&gt;%
  select(admin_region, basal_area_mean)

ifn_data
```

```
## Simple feature collection with 41 features and 2 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 0.1626252 ymin: 40.52296 xmax: 3.321198 ymax: 42.86144
## Geodetic CRS:  WGS 84
## First 10 features:
##      admin_region basal_area_mean                           geom
## 1        Alt Camp        17.54411 MULTIPOLYGON (((1.495952 41...
## 2     Alt Empordà        21.92353 MULTIPOLYGON (((3.170083 42...
## 3     Alt Penedès        13.76532 MULTIPOLYGON (((1.837855 41...
## 4      Alt Urgell        23.87964 MULTIPOLYGON (((1.319412 41...
## 5  Alta Ribagorça        23.90475 MULTIPOLYGON (((0.9378095 4...
## 6           Anoia        13.88724 MULTIPOLYGON (((1.47133 41....
## 7           Bages        12.41668 MULTIPOLYGON (((2.040477 41...
## 8       Baix Camp        16.57311 MULTIPOLYGON (((1.06411 41....
## 9       Baix Ebre        18.64874 MULTIPOLYGON (((0.5591292 4...
## 10   Baix Empordà        20.28939 MULTIPOLYGON (((3.170083 42...
```

---

## Joining fetarure sets

By geometries


```r
st_join(lidar_data, ifn_data, join = st_intersects)
```

```
## Simple feature collection with 233 features and 11 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 0.1626252 ymin: 40.52296 xmax: 3.321198 ymax: 42.86144
## Geodetic CRS:  WGS 84
## First 10 features:
##         poly_id  poly_km2 AB_pixels AB_average    AB_sd AB_min AB_max   AB_km2 AB_km2_perc
## 1      Alt Camp  537.6352    482120   16.69471 8.207308   0.01    100 192.8480    35.86968
## 1.1    Alt Camp  537.6352    482120   16.69471 8.207308   0.01    100 192.8480    35.86968
## 1.2    Alt Camp  537.6352    482120   16.69471 8.207308   0.01    100 192.8480    35.86968
## 1.3    Alt Camp  537.6352    482120   16.69471 8.207308   0.01    100 192.8480    35.86968
## 1.4    Alt Camp  537.6352    482120   16.69471 8.207308   0.01    100 192.8480    35.86968
## 1.5    Alt Camp  537.6352    482120   16.69471 8.207308   0.01    100 192.8480    35.86968
## 1.6    Alt Camp  537.6352    482120   16.69471 8.207308   0.01    100 192.8480    35.86968
## 2   Alt Empordà 1356.8555   1393054   20.31397 8.609172   0.01    100 557.2216    41.06713
## 2.1 Alt Empordà 1356.8555   1393054   20.31397 8.609172   0.01    100 557.2216    41.06713
## 2.2 Alt Empordà 1356.8555   1393054   20.31397 8.609172   0.01    100 557.2216    41.06713
##         admin_region basal_area_mean                           geom
## 1           Alt Camp        17.54411 MULTIPOLYGON (((1.495952 41...
## 1.1      Alt Penedès        13.76532 MULTIPOLYGON (((1.495952 41...
## 1.2            Anoia        13.88724 MULTIPOLYGON (((1.495952 41...
## 1.3        Baix Camp        16.57311 MULTIPOLYGON (((1.495952 41...
## 1.4     Baix Penedès        14.81808 MULTIPOLYGON (((1.495952 41...
## 1.5 Conca de Barberà        16.86359 MULTIPOLYGON (((1.495952 41...
## 1.6       Tarragonès        12.25949 MULTIPOLYGON (((1.495952 41...
## 2        Alt Empordà        21.92353 MULTIPOLYGON (((3.170083 42...
## 2.1     Baix Empordà        20.28939 MULTIPOLYGON (((3.170083 42...
## 2.2         Garrotxa        23.13789 MULTIPOLYGON (((3.170083 42...
```

---

## Joining fetarure sets

By geometries


```r
st_join(lidar_data, st_centroid(ifn_data), join = st_intersects)
```

```
## Warning in st_centroid.sf(ifn_data): st_centroid assumes attributes are constant over geometries of
## x
```

```
## Simple feature collection with 42 features and 11 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 0.1626252 ymin: 40.52296 xmax: 3.321198 ymax: 42.86144
## Geodetic CRS:  WGS 84
## First 10 features:
##           poly_id  poly_km2 AB_pixels AB_average     AB_sd AB_min AB_max    AB_km2 AB_km2_perc
## 1        Alt Camp  537.6352    482120   16.69471  8.207308   0.01    100  192.8480    35.86968
## 2     Alt Empordà 1356.8555   1393054   20.31397  8.609172   0.01    100  557.2216    41.06713
## 3     Alt Penedès  592.7758    488554   17.65630  9.036426   0.01    100  195.4216    32.96720
## 4      Alt Urgell 1447.2226   2516325   24.93210 14.876077   0.01    100 1006.5300    69.54908
## 5  Alta Ribagorça  427.2234    437735   27.79429 18.256835   0.01    100  175.0940    40.98418
## 6           Anoia  866.6878    976681   16.50647  8.703730   0.01    100  390.6724    45.07648
## 7           Bages 1092.7763   1455613   16.45591  8.884009   0.01    100  582.2452    53.28128
## 8       Baix Camp  697.0773    590955   16.72298  8.028576   0.01    100  236.3820    33.91044
## 9       Baix Ebre 1002.1005    558271   16.74180  9.326562   0.01    100  223.3084    22.28403
## 10   Baix Empordà  701.3843    862685   18.40010  8.052129   0.02    100  345.0740    49.19899
##      admin_region basal_area_mean                           geom
## 1        Alt Camp        17.54411 MULTIPOLYGON (((1.495952 41...
## 2     Alt Empordà        21.92353 MULTIPOLYGON (((3.170083 42...
## 3     Alt Penedès        13.76532 MULTIPOLYGON (((1.837855 41...
## 4      Alt Urgell        23.87964 MULTIPOLYGON (((1.319412 41...
## 5  Alta Ribagorça        23.90475 MULTIPOLYGON (((0.9378095 4...
## 6           Anoia        13.88724 MULTIPOLYGON (((1.47133 41....
## 7           Bages        12.41668 MULTIPOLYGON (((2.040477 41...
## 8       Baix Camp        16.57311 MULTIPOLYGON (((1.06411 41....
## 9       Baix Ebre        18.64874 MULTIPOLYGON (((0.5591292 4...
## 10   Baix Empordà        20.28939 MULTIPOLYGON (((3.170083 42...
```

---

## Plotting


```r
plot(lidar_data)
```

&lt;img src="index_files/figure-html/plotting-1.png" style="display: block; margin: auto;" /&gt;

---

## Plotting


```r
plot(lidar_data, max.plot = 2)
```

&lt;img src="index_files/figure-html/plotting_2-1.png" style="display: block; margin: auto;" /&gt;

---

## Plotting


```r
plot(lidar_data[, "AB_average"], axes = TRUE)
```

&lt;img src="index_files/figure-html/plotting_3-1.png" style="display: block; margin: auto;" /&gt;

---

## Plotting


```r
plot(lidar_data[, "AB_average"], axes = TRUE, key.pos = 4)
```

&lt;img src="index_files/figure-html/plotting_4-1.png" style="display: block; margin: auto;" /&gt;

---

## Plotting


```r
plot(lidar_data[, "AB_average"], axes = TRUE, key.pos = 4, graticule = TRUE)
```

&lt;img src="index_files/figure-html/plotting_5-1.png" style="display: block; margin: auto;" /&gt;

---

## Plotting


```r
plot(lidar_data[, "AB_average"], axes = TRUE, key.pos = 4, graticule = TRUE, breaks = c(0, 15, 20, 40))
```

&lt;img src="index_files/figure-html/plotting_6-1.png" style="display: block; margin: auto;" /&gt;

---

## ggplot2


```r
library(ggplot2)
lidar_data %&gt;%
  ggplot() +
  geom_sf(aes(fill = AB_average)) +
  scale_fill_fermenter(palette = 2, direction = 1, type = 'div')
```

&lt;img src="index_files/figure-html/ggplot-1.png" style="display: block; margin: auto;" /&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
